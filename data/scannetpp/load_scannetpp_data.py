# Modified from
# https://github.com/facebookresearch/votenet/blob/master/scannet/load_scannet_data.py
# Copyright (c) Facebook, Inc. and its affiliates.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.
"""Load Scannet scenes with vertices and ground truth labels for semantic and
instance segmentations."""
import argparse
import inspect
import json
import os

import numpy as np
import open3d as o3d
import scannet_utils

currentdir = os.path.dirname(
    os.path.abspath(inspect.getfile(inspect.currentframe())))

SCANNETPP_LABELS = [
            "wall",
            "ceiling",
            "floor",
            "door",
            "table",
            "cabinet",
            "ceiling lamp",
            "curtain",
            "chair",
            "blinds",
            "storage cabinet",
            "bookshelf",
            "office chair",
            "window",
            "whiteboard",
            "ceiling light",
            "fake ceiling",
            "monitor",
            "shelf",
            "object",
            "window frame",
            "pipe",
            "structure",
            "box",
            "heater",
            "kitchen cabinet",
            "storage rack",
            "sofa",
            "bed",
            "shower wall",
            "doorframe",
            "door frame",
            "roof",
            "wardrobe",
            "pillar",
            "plant",
            "blanket",
            "machine",
            "windowsill",
            "linked retractable seats",
            "window sill",
            "cardboard box",
            "tv",
            "books",
            "desk",
            "computer tower",
            "kitchen counter",
            "trash can",
            "trash bin",
            "jacket",
            "electrical duct",
            "blackboard",
            "cable tray",
            "air duct",
            "sink",
            "carpet",
            "bag",
            "counter",
            "refrigerator",
            "picture",
            "pillow",
            "cupboard",
            "window blind",
            "towel",
            "beam",
            "office table",
            "stool",
            "suitcase",
            "backpack",
            "bathtub",
            "rug",
            "keyboard",
            "rack",
            "gym mat",
            "toilet",
            "suspended ceiling",
            "shower floor",
            "clothes",
            "pipe storage rack",
            "air conditioner",
            "fume hood",
            "printer",
            "blind",
            "poster",
            "experiment bench",
            "electrical control panel",
            "shower curtain",
            "windowframe",
            "book",
            "ceiling beam",
            "painting",
            "paper",
            "ladder",
            "laboratory bench",
            "bench",
            "milling machine",
            "microwave",
            "partition",
            "board",
            "office cabinet",
            "rolling cart",
            "laboratory cabinet",
            "crate",
            "raised floor",
            "electrical panel",
            "mattress",
            "bottle",
            "pedestal fan",
            "sofa chair",
            "headboard",
            "fridge",
            "bucket",
            "kitchen unit",
            "beanbag",
            "construction materials",
            "oven",
            "pipes",
            "cushion",
            "power socket",
            "office desk",
            "whiteboards",
            "lab equipment",
            "shoes",
            "work bench",
            "file cabinet",
            "mirror",
            "basket",
            "beverage crate",
            "washing machine",
            "shoe rack",
            "hydraulic press",
            "photocopy machine",
            "telephone",
            "lab machine",
            "joined tables",
            "sliding door",
            "tv stand",
            "objects",
            "couch",
            "coat",
            "open cabinet",
            "scientific equipment",
            "coffee table",
            "garage door",
            "bin",
            "radiator",
            "standing lamp",
            "stove",
            "roller blinds",
            "fume cupboard",
            "pc",
            "stairs",
            "medical appliance",
            "closet",
            "trolley",
            "file folder",
            "projector",
            "cloth",
            "conference table",
            "cardboard",
            "blind rail",
            "dishwasher",
            "room divider",
            "copier",
            "ventilation pipe",
            "bathroom cabinet",
            "laptop",
            "electrical box",
            "arm chair",
            "bar counter",
            "stage",
            "ceiling ventilator",
            "lounge chair",
            "plant pot",
            "bathroom stall",
            "pinboard",
            "false ceiling",
            "comforter",
            "3d printer",
            "steel beam",
            "projector screen",
            "electric duct",
            "cart",
            "air pipe",
            "training equipment",
            "floor mounted air conditioner",
            "tile wall",
            "glass wall",
            "exhaust fan",
            "vacuum cleaner",
            "ceiling lights",
            "laundry basket",
            "nightstand",
            "armchair",
            "drying rack",
            "indoor crane",
            "storage trolley",
            "dresser",
            "l-shaped sofa",
            "coat hanger",
            "dining chair",
            "office visitor chair",
            "interactive board",
            "hose",
            "light switch",
            "shower ceiling",
            "coffee machine",
            "cables",
            "floor lamp",
            "fan",
            "wire tray",
            "compressor",
            "laboratory equipment",
            "dining table",
            "speaker",
            "climbing wall",
            "light",
            "paper towel dispenser",
            "coat rack",
            "table lamp",
            "frame",
            "duvet",
            "fire extinguisher",
            "range hood",
            "high table",
            "backdrop",
            "ventilation duct",
            "papers",
            "seat",
            "tablecloth",
            "electrical cabinet",
            "ping pong table",
            "bathroom floor",
            "ceiling pipe",
            "bedside table",
            "coffee maker",
            "computer desk",
            "urinal",
            "loft bed",
            "air vent",
            "chairs",
            "bedsheet",
            "television",
            "lamp",
            "rolling chair",
            "wall cabinet",
            "book shelf",
            "brick wall",
            "treadmill",
            "vent",
            "shirt",
            "canopy bed",
            "clothes hanger",
            "kettle",
            "cardboards",
            "shoe",
            "high stool",
            "tripod",
            "bar stool",
            "exhaust duct",
            "wooden plank",
            "squat rack",
            "cubicle door",
            "folding screen",
            "kitchen sink",
            "container",
            "bottles",
            "ottoman",
            "bicycle",
            "staircase railing",
            "overhead projector",
            "surfboard",
            "folder",
            "power strip",
            "high bench",
            "wall beam",
            "pallet cage",
            "interactive whiteboard",
            "floor sofa",
            "duct",
            "flat panel display",
            "wooden frame",
            "folding room divider",
            "cable",
            "mug",
            "rolling table",
            "locker",
            "standing banner",
            "decoration",
            "clothes drying rack",
            "foosball table",
            "standing poster",
            "bath tub",
            "yoga mat",
            "microscope",
            "paper bag",
            "mouse",
            "umbrella",
            "medical machine",
            "smoke detector",
            "cup",
            "cutting board",
            "console",
            "drum",
            "bathroom counter",
            "toilet paper",
            "robot car",
            "exhaust pipe",
            "bath cabinet",
            "whiteboard stand",
            "electrical control panels",
            "notice board",
            "paper towel",
            "crates",
            "bed frame",
            "bathroom mat",
            "shower partition",
            "cloth hangers",
            "clothes cabinet",
            "tv screen",
            "babyfoot table",
            "rolling curtain",
            "coat stand",
            "kitchen towel",
            "plank",
            "side table",
            "storage shelf",
            "mat",
            "shower",
            "white board",
            "information board",
            "backsplash",
            "guitar",
            "cloth rack",
            "ceiling vent",
            "partition wall",
            "kitchen shelf",
            "banner",
            "file binder",
            "cleaning trolley",
            "racing simulator",
            "workbench",
            "pot",
            "ac system",
            "power panel",
            "desk lamp",
            "broom",
            "wall /other room",
            "cpu",
            "fitted wardrobe",
            "tote bag",
            "plumbing pipe",
            "slippers",
            "blackboard frame",
            "magazine",
            "hose pipe",
            "rolled paper",
            "sweater",
            "clock",
            "tray",
            "desk fan",
            "vaccum cleaner",
            "projection curtain",
            "freezer display counter",
            "pan",
            "vase",
            "glass",
            "folders",
            "tap",
            "wall lamp",
            "plate",
            "laptop stand",
            "small cabinet",
            "file organizer",
            "clothes dryer",
            "wall painting",
            "paper towels",
            "curtain rail",
            "wheelchair",
            "bottle crate",
            "sheet",
            "folding sofa",
            "shower pan",
            "plastic case",
            "christmas tree",
            "piano",
            "ottoman chair",
            "jar",
            "foldable closet",
            "notebook",
            "calendar",
            "janitor cart",
            "storage box",
            "rolling blinds",
            "bathroom shelf",
            "soap dispenser",
            "binder",
            "wooden planks",
            "copy machine",
            "rice cooker",
            "gym mattress",
            "car door",
            "table football",
            "bowl",
            "light panel",
            "tissue box",
            "bedframe",
            "wall hanging",
            "jug",
            "skylight",
            "ceiling fan",
            "dish rack",
            "shelving cart",
            "instant pot",
            "whiteboard eraser",
            "floor mat",
            "socket",
            "mini fridge",
            "wall clock",
            "boots",
            "barbecue grill",
            "paper shredder",
            "file rack",
            "floor scrubber",
            "metal board",
            "water heater",
            "tool rack",
            "recliner",
            "barber chair",
            "ventilator",
            "trolley table",
            "standing fan",
            "water filter",
            "shoes holder",
            "wood planks",
            "vr setup",
            "trashcan",
            "bike",
            "lab materials",
            "wooden pallet",
            "dustbin",
            "curtain rod",
            "reflection",
            "toilet brush",
            "exercise ball",
            "air purifier",
            "kitchen back splash",
            "paper rack",
            "toolbox",
            "monitor cover",
            "file",
            "surfsuit",
            "ceiling cables",
            "night stand",
            "paper organizer",
            "serving trolley",
            "phone",
            "canvas",
            "camping bed",
            "tower pc",
            "cylinder",
            "magazine stand",
            "toy",
            "slipper",
            "air conditioning",
            "hanger",
            "vertical blinds",
            "desk organizer",
            "guitar bag",
            "spray bottle",
            "suit cover",
            "toaster",
            "spotlight",
            "machine container",
            "foot rest",
            "shopping trolley",
            "decoration piece",
            "control panel",
            "multifunction printer",
            "jerry can",
            "window head",
            "cooker hood",
            "basin",
            "panel",
            "papasan chair",
            "tv mount",
            "toilet seat",
            "shopping bag",
            "photocopier",
            "tube",
            "studio light",
            "stuffed toy",
            "cord cover",
            "power cabinet",
            "power cables",
            "filer organizer",
            "garage shelf",
            "jackets",
            "files",
            "luggage",
            "gym bag",
            "exhaust hood",
            "microwave oven",
            "floor cushion",
            "easy chair",
            "bar table",
            "shoe cabinet",
            "paper tray",
            "lab coat",
            "toilet paper dispenser",
            "kitchen storage rack",
            "equipment",
            "computer table",
            "mouse pad",
            "drawer",
            "headphones",
            "boxes",
            "bathroom sink",
            "outlet",
            "toaster oven",
            "tv table",
            "bedside cabinet",
            "rolling trolley",
            "step stool",
            "trousers",
            "bathroom rack",
            "shelf trolley",
            "glass shelf",
            "fabric",
            "lab fridge",
            "ceiling lamps",
            "work station",
            "barrel",
            "mop",
            "deck chair",
            "bath counter",
            "helmet",
            "standing clothes hanger",
            "garbage bin",
            "study table",
            "air fryer",
            "plastic bag",
            "oven range",
            "headphone",
            "kitchen counter top",
            "clothes rack",
            "wall unit",
            "grab bar",
            "flipchart",
            "scarf",
            "labcoat",
            "hat",
            "bedside lamp",
            "sewing machine table",
            "shower head",
            "dishes",
            "switchboard cabinet",
            "flip paper",
            "storage container",
            "canister",
            "wall board",
            "shower rug",
            "plastic box",
            "stovetop",
            "information stand",
            "footstool",
            "pack",
            "push cart",
            "table cloth",
            "celing lamp",
            "cupoard",
            "jeans",
            "smoke alarm",
            "beverage crates",
            "mattresses",
            "bath mat",
            "softbox",
            "whiteboard mount",
            "paper cutter",
            "plates",
            "cable raceway",
            "water kettle",
            "pictures",
            "pelican case",
            "towel rack",
            "rolling shelf cart",
            "built-in shelf",
            "documents",
            "equipment cover",
            "television stand",
            "bags",
            "sheets",
            "small dresser",
            "light stand",
            "beach umbrella",
            "faucet",
            "bagpack",
            "dumbbell",
            "water dispenser",
            "paper trays",
            "flowers",
            "tube lights",
            "medicine cabinet",
            "tv console",
            "mirror frame",
            "chandelier",
            "pen holder",
            "messenger bag",
            "ball",
            "glass bottle",
            "power sockets",
            "softbox light",
            "gym ball",
            "briefcase",
            "plastic bottle",
            "monitor stand",
            "human skeleton",
            "podium",
            "wall strip",
            "rods",
            "tablet",
            "bedside shelf",
            "headrail",
            "sink counter",
            "doormat",
            "baseboard",
            "bulletin board",
            "electric hob",
            "bean bag",
            "high pressure cylinder",
            "portable fan",
            "flush button",
            "wooden post",
            "lectern",
            "curtain frame",
            "computer monitor",
            "folding chair",
            "tabletop",
            "led ceiling fan",
            "high chair",
            "grill",
            "metal rack",
            "air conditioner tower",
            "sliding door frame",
            "cable rack",
            "drawers",
            "bench press",
            "ironing board",
            "wooden palette",
            "kitchenware",
            "blind rails",
            "plastic container",
            "curtain rails",
            "weighing scale",
            "headset",
            "tree trunk",
            "shower screen",
            "wall shelf",
            "watering can",
            "tool box",
            "file shelves",
            "bed sheet",
            "glass pane",
            "tower fan",
            "switch",
            "notice",
            "sack",
            "table mat",
            "flower pot",
            "dog bed",
            "laundry hanger",
            "mobile tv stand",
            "magazines",
            "file holder",
            "floor couch",
            "tv trolley",
            "chopping board",
            "centrifuge",
            "tubelight",
            "bedpost",
            "step",
            "center table",
            "upholstered bench",
            "sink pipe",
            "door mat",
            "storage bin",
            "towel radiator",
            "shower tray",
            "filefolders",
            "rolled papers",
            "electronic appliance",
            "boiler",
            "food container",
            "cable pathway",
            "carboard box",
            "metal sheet",
            "hand bag",
            "sign",
            "laundry rack",
            "screen",
            "cardbox",
            "fireplace surround",
            "boot",
            "envelope",
            "stools",
            "carton",
            "tool organizer",
            "kitchen utensils",
            "wall hooks",
            "paper roll",
            "water bottle",
            "shoe changing stool",
            "balcony door",
            "espresso machine",
            "water pipe",
            "trash cans",
            "recesssed shelf",
            "drum set",
            "skiboard",
            "speaker stand",
            "kitchen wall",
            "suit",
            "photo",
            "globe",
            "spice rack",
            "bulletin boards",
            "delivery bag",
            "router",
            "rolling blind",
            "easel",
            "shower cubicle",
            "dish drainer",
            "doorway",
            "folded table",
            "pants",
            "computer",
            "stuffed animal",
            "office chair",
            "cable conduit",
            "picture frame",
            "shoe stool",
            "recessed shelve",
            "toilet paper holder",
            "panelboard",
            "stapler",
            "skateboard",
            "workshop tool",
            "projector holder",
            "flag",
            "chemical canister",
            "web cam",
            "hoodie",
            "towel heater",
            "towel warmer",
            "shower curtain rod",
            "shower faucet",
            "water pipes",
            "shower door",
            "laboratory power supply",
            "tool",
            "ventilation",
            "soap bottle",
            "bathrobe",
            "pictures board",
            "cap",
            "woofer",
            "tshirt",
            "rolling bag",
            "shoe box",
            "luggage bag",
            "file storage",
            "cat bed",
            "stack of paper",
            "surfing board",
            "electric kettle",
            "rolling stand",
            "cover",
            "main switchboard",
            "pressure cooker",
            "stepladder",
            "countertop",
            "flip flops",
            "short table",
            "sit-up pillow",
            "duffel bag",
            "shower seating",
            "washbasin",
            "teddy bear",
            "stair",
            "plate rack",
            "ornament",
            "jerrycan",
            "filter jug",
            "t shirt",
            "cooking pot",
            "platform trolley",
            "blinds rod",
            "hand shower",
            "power socket unit",
            "sheep doll",
            "laptop bag",
            "game console",
            "bottles case",
            "lid",
            "dumbbell case",
            "rolled blanket",
            "paper stapler",
            "kitchen pot",
            "charcoal bag",
            "laundry hamper",
            "rolled poster",
            "bath towel",
            "apron",
            "dustpan",
            "trash bag",
            "document tray",
            "camera",
            "mirror cabinet",
            "dish drying rack",
            "gas tank",
            "cable roller",
            "case",
            "ring light",
            "hair dryer",
            "gym plate",
            "hand towel",
            "sill",
            "sidetable",
            "vice",
            "bench stool",
            "billboard",
            "rolling cabinet",
            "shower sink",
            "cloth piece",
            "oscilloscope",
            "condiments",
            "magazine rack",
            "wash basin",
            "cable panel",
            "photo frame",
            "tv receiver",
            "stand",
            "milk jug",
            "wooden board",
            "bladeless fan",
            "door frame",
            "wall paper",
            "scale",
            "purse",
            "electronic device",
            "sofa cushion",
            "sponge",
            "dish washer",
            "crate trolley",
            "tools",
            "kitchen hood",
            "laundry vent",
            "medical stool",
            "exhaustive fan",
            "portable ladder",
            "chemical container",
            "toilet paper rolls",
            "rag",
            "blender",
            "window pane",
            "dog bowl",
            "shopping basket",
            "piano stool",
            "electric box",
            "wall calendar",
            "paper holder",
            "chemical bottle",
            "coat hangers",
            "sandals",
            "foreman grill",
            "guitar case",
            "heater tube",
            "running shoes",
            "shower tap",
            "cloth hanger",
            "microphone",
            "cabinet frame",
            "decorative object",
            "light fixture",
            "paintings",
            "ceiling lamp bar",
            "paperbag",
            "chemical barrel",
            "wicker basket",
            "exit sign",
            "bottles rack",
            "water jug",
            "bottle carrier",
            "laboratory pellet press",
            "mini oven",
            "shower arm",
            "paper tube",
            "suitcase stand",
            "table fan",
            "shelve",
            "full-length mirror",
            "wood piece",
            "can",
            "suit bag",
            "water bubbler",
            "cushions",
            "first aid kit",
            "kitchen robot",
            "toilet flush button",
            "pillow toy",
            "plush doll",
            "styrofoam box",
            "document organizer",
            "pet carrier",
            "folding table",
            "gloves",
            "pitcher",
            "cable spool",
            "dumbbells",
            "rolled cable",
            "folding umbrella",
            "robot vacuum cleaner",
            "tower ventilator",
            "brush",
            "planter",
            "baseball cap",
            "gas cylinder",
            "paper files",
            "stereo",
            "baby stroller",
            "posters",
            "notebooks",
            "water bucket",
            "rucksack",
            "shower door frame",
            "drone",
            "kitchen cloth",
            "hand soap dispenser",
            "pegboard",
            "alarm",
            "emergency light",
            "sign board",
            "spice jars",
            "weight plate",
            "rolled projection screen",
            "keyboards",
            "laptop table",
            "hole puncher",
            "mixer",
            "piano chair",
            "paper bin",
            "wooden stick",
            "anti splatter shield",
            "fireplace",
            "rolled backdrop",
            "mousepad",
            "long pillow",
            "bananas",
            "column",
            "cd player",
            "eraser",
            "laptop sleeve",
            "hairdryer",
            "seat cushion",
            "plant pot mat",
            "wastebin",
            "wood panel",
            "detergent bottle",
            "safe box",
            "pouch",
            "blind rod",
            "mop basin",
            "plug",
            "document holder",
            "railing",
            "towels",
            "cutting boards",
            "plastic drum",
            "stack of tyres",
            "cat tree",
            "mirror light",
            "kettlebell",
            "chart",
            "dust pan",
            "sandal",
            "first aid cabinet",
            "bracket",
            "wire",
            "scooter",
            "racing wheel",
            "wine rack",
            "belt",
            "tissue dispenser stand",
            "towel paper dispenser",
            "air heater",
            "plushie",
            "knife set",
            "iron",
            "intercom",
            "kitchen ceiling",
            "package",
            "toilet paper dispensor",
            "sneakers",
            "umbrella stand",
            "egg carton",
            "organizer",
            "stick",
            "shampoo bottle",
            "cone",
            "pile of papers",
            "file tray",
            "wooden plan",
            "cooking pan",
            "brief",
            "paper towel package",
            "glove dispenser",
            "dispenser bottle",
            "kitchen drawer",
            "remote control",
            "powerstrip",
            "emergency shower",
            "scanner",
            "towel holder",
            "vr headset",
            "watering pot",
            "soda machine",
            "pole stand",
            "paper towel rolls",
            "roomba",
            "rolling mat",
            "fluorescent lamp",
            "flower",
            "pc tower",
            "metal mount",
            "oven gloves",
            "soap",
            "flush tank",
            "notepad",
            "pull up bar",
            "loafers",
            "water meter cover",
            "plastic tray",
            "webcam",
            "barbell",
            "tea pot",
            "wall hanger",
            "cabinet base panel",
            "laptop case",
            "paper towel holder",
            "skeleton",
            "socket extender",
            "extension chord reel",
            "wooden crate",
            "guillotine paper cutter",
            "sewing machine",
            "model car",
            "bed cover",
            "storage",
            "freezer",
            "piano book",
            "wifi router",
            "overhead shower",
            "chrismas tree",
            "drill",
            "clothes drying stand",
            "dumbell",
            "cabel",
            "badminton racket",
            "cool box",
            "thermostat",
            "dartboard",
            "switchboard cover",
            "candle",
            "electric stove",
            "paper ram",
            "notes",
            "insulated can",
            "prosthetic leg",
            "desk power strip",
            "utensils",
            "closet rail",
            "water pitcher",
            "plate weights",
            "extension cord",
            "toilet papers",
            "tea box",
            "tissue",
            "sauce pan",
            "postcards",
            "toothbrush",
            "floor mats",
            "frying pan",
            "package of paper",
            "microphone stand",
            "socket box",
            "leather mattress",
            "plastic can",
            "garbage bin cover",
            "plush toy",
            "electric guitar",
            "weight scale",
            "fruit",
            "tape dispenser",
            "pallet",
            "emergency kit",
            "bathroom mirror",
            "cloths",
            "door lamp",
            "power extension",
            "electric circuit board",
            "oven panel",
            "electrical pipe",
            "wall mounts",
            "shade",
            "photoframe",
            "file stack",
            "pizza box",
            "tennis racket",
            "wall hook",
            "recycle bag",
            "recessed shower shelve",
            "wall mounted telephone",
            "facsimile",
            "kitchen roll",
            "milk cartons",
            "totebag",
            "floor cleaner",
            "body weight scale",
            "stuffed animal door insulator",
            "wooden shelves",
            "neck pillow",
            "basketball",
            "cable wheel",
            "door vent",
            "foot massager",
            "pumper",
            "hanging light fixture",
            "interphone",
            "paper towel roll",
            "control unit",
            "folder oragnizer",
            "hanging frame",
            "paper stack",
            "door handle",
            "mini shelf",
            "beverage carton",
            "wok pan",
            "bedside counter",
            "bar",
            "pot lid",
            "radio",
            "paper box",
            "stabilizer",
            "headphone case",
            "folded cardboard box",
            "coaster",
            "pen tray",
            "marker",
            "shower mat",
            "rod",
            "device",
            "electric pot",
            "mixer machine",
            "barstool",
            "bread toaster",
            "electric mixer",
            "wall cord cover",
            "camera bag",
            "charger",
            "knife",
            "metal frame",
            "folded bag",
            "conduit pipe",
            "french press",
            "cabinet side panel",
            "cosmetic bag",
            "surveillance camera",
            "bathroom holder",
            "footrest",
            "glasses case",
            "handbag",
            "cooling pad",
            "flip flop",
            "game controller",
            "packet of toilet paper",
            "cable duct",
            "toilet paper roll",
            "monitor support",
            "fire alarm",
            "kitchen stove",
            "key hanger",
            "tub",
            "network socket",
            "ceilng light",
            "christmas ornament",
            "pepper mill",
            "wall outlet",
            "light cover",
            "caution board",
            "heels",
            "package bag",
            "blinds rail",
            "candle holder",
            "electric toothbrush",
            "pens",
            "tool case",
            "toilet flush",
            "wooden brush",
            "hand washing soap",
            "hygiene product",
            "water tap",
            "cosmetic pouch",
            "mount",
            "brushes",
            "knife holder",
            "dustpan and brush",
            "circular tray",
            "shoe case",
            "ar tag",
            "flipflop",
            "sculpture",
            "recycle bin",
            "kitchen utensil",
            "multiplug",
            "beaker stand",
            "chessboard",
            "pen",
            "toothpaste",
            "tv remote",
            "floor wiper",
            "wire hider",
            "water meter",
            "magazine holder",
            "mailbox",
            "paper file",
            "wall coat hanger",
            "utensil holder",
            "detergent",
            "safe",
            "packet",
            "dvd",
            "apples",
            "dvd player",
            "tupperware",
            "electrical board",
            "radiator pipe",
            "plat",
            "decorative mirror",
            "telephone stand",
            "water boiler",
            "cutboard",
            "hanging deer skull",
            "file orginizer",
            "satchel",
            "head model",
            "parcel",
            "dish soap bottle",
            "glass plate",
            "pencil case",
            "cleaning mop",
            "mixer glass",
            "joystick",
            "vacuum flask",
            "bag of oranges",
            "pencil holder",
            "pamphlet",
            "rope",
            "cd",
            "knife stand",
            "pencil cup",
            "binding machine",
            "grill pan",
            "tape",
            "cabinet top panel",
            "cutti̇ng board",
            "salad spinner",
            "water filter jug",
            "mop cloth",
            "sticky notes",
            "shower valve",
            "laptop cover",
            "running shoe",
            "toy models",
            "alligator clips",
            "insulated coffee mug",
            "pencil stand",
            "action figure",
            "desk light",
            "midi controller",
            "bathroom slippers",
            "elephant decoration piece",
            "switchboard",
            "remote",
            "arch folder",
            "power cord",
            "hot bag",
            "pencils cup",
            "knife block",
            "thermos",
            "power switch",
            "toothbrush holder",
            "cleaning liquid",
            "power board",
            "pull-up bar",
            "sandwich maker",
            "statue",
            "brief case",
            "airdyer",
            "bike helmet",
            "mirror lamp",
            "tennis rackets",
            "paint jar",
            "citrus juicer",
            "scissors",
            "hanging hook",
            "napkin",
            "laundry detergent",
            "disinfectant dispenser",
            "cleaning brush",
            "food",
            "pan set",
            "kitchen appliance",
            "mop pad",
            "dish soap",
            "plunger",
            "paper package",
            "plastic mat",
            "calculator",
            "voltage stabilizer",
            "whiteboard marker",
            "wall coat rack",
            "milk carton",
            "cosmetic bottle",
            "shower handle",
            "tissue paper",
            "shorts",
            "game console controller",
            "remote controller",
            "teapot",
            "drain",
            "juice box",
            "phone stand",
            "soap container",
            "flush",
            "rubber water bag",
            "shower gel",
            "envelopes",
            "snack bag",
            "watering bucket",
            "first aid box",
            "banana",
            "paper notebook",
            "hammer",
            "kitchen glove",
            "handle",
            "personal hygiene product",
            "duster",
            "robot vaccuum cleaner",
            "chain",
            "soap dish",
            "cereal box",
            "door window",
            "elephant toy",
            "frisbee",
            "cream tube",
            "folder holder",
            "internet socket",
            "moka pot",
            "stereo box",
            "face mask",
            "bunny chocolate",
            "magazine collector",
            "green vegetables",
            "shower holder",
            "toilet brush",
            "oven glove",
            "shower drain",
            "penholder",
            "switch board",
            "coffee pot",
            "marker eraser",
            "squeegee",
            "onions",
            "spray",
            "game cd box",
            "table clock",
            "apple",
            "spool",
            "portable speaker",
            "guitar pedal",
            "bread",
            "glass jar",
            "paper puncher",
            "dishwashing sponge",
            "shower hose",
            "surface cleaning liquid",
            "wallet",
            "circuit box",
            "toiletry",
            "hair brush",
            "headphone bag",
            "paper packages",
            "metal saw",
            "power adapter",
            "wlan router",
            "plant pot coaster",
            "oven mitt",
            "hanging light",
            "kitchen object",
            "machine button",
            "vanity light",
            "flush plate",
            "coasters",
            "leaf fan",
            "punching machine",
            "window handle",
            "light switches",
            "wine bottle",
            "tennis cap",
            "chips can",
            "food pot",
            "hand washing soap dispenser",
            "sockets",
            "wall light",
            "wet wipes",
            "detergent bag",
            "glasses cover",
            "hangbag",
            "bottle spray",
            "kitchen tap",
            "knob",
            "figurine",
            "hand vacuum",
            "potted plant",
            "weights",
            "marker storage",
            "mixing bowl",
            "power supply",
            "intercom screen",
            "coffee mug",
            "drilling machine",
            "electric socket",
            "hand shower handle",
            "hole punch",
            "silicon gun",
            "document holder",
            "wooden chest",
            "cheese",
            "jars",
            "headphones case",
            "measuring spoon",
            "monitor light",
            "ear muffs",
            "night lamp",
            "wall handle",
            "intercom device",
            "lanyard",
            "rugby ball",
            "shower loofah",
            "cable socket",
            "cleaning cloth",
            "dish washer soap",
            "magnets",
            "power brick",
            "coffee",
            "monitor base",
            "mushroom lamp",
            "trivet",
            "surface cleaner",
            "toiletry bottle",
            "paper note",
            "strainer",
            "colander",
            "kitchen brush",
            "multi socket",
            "radiator pipes",
            "saucer",
            "scissor",
            "stamp",
            "emergency button",
            "toilet brush holder",
            "coffee jar",
            "deodorant",
            "shower rod",
            "wet tissue",
            "tissue paper roll",
            "funnel",
            "oragnizer",
            "toilet plunger",
            "tumbler",
            "door knob",
            "coarser",
            "postit note",
            "punching tool",
            "beverage can",
            "dish",
            "star",
            "flask",
            "in-table power socket",
            "laptop charger",
            "wall intercom",
            "flour bag",
            "blowtorch",
            "cleaner",
            "takeout box",
            "hand soap",
            "hard drive",
            "straws",
            "monitor holder",
            "soldering iron",
            "control switch",
            "drainage",
            "box lid",
            "playstation controller",
            "shaving foam",
            "guitar stand",
            "toilet cleaner",
            "co detector",
            "covered power socket",
            "spray can",
            "tooth brush",
            "phone tripod",
            "bluetooth speaker",
            "paper rolls",
            "shelves",
            "dish washing liquid",
            "powerbank",
            "dried plant",
            "shampoo",
            "sticky note",
            "toilet seat brush",
            "dishwashing soap",
            "lan port",
            "scrubber",
            "tissues",
            "cord",
            "ashtray",
            "handle bar",
            "speakers",
            "dongle",
            "liquid soap",
            "mobile phone",
            "bunny decoration",
            "palm rest",
            "stream deck",
            "blinds chain",
            "dishwashing liquid",
            "hammer holder",
            "hand washing liquid",
            "shower wiper",
            "duct tape",
            "valve",
            "glove",
            "stationery",
            "ceiling speaker",
            "holder",
            "power plug",
            "wall speaker",
            "card",
            "electrical tape",
            "pot cover",
            "razor",
            "barcode scanner",
            "lotion",
            "eggs",
            "grab rail",
            "hairbrush",
            "lint roller",
            "post-it",
            "switches",
            "dusting cloth",
            "glue bottle",
            "handwash",
            "network outlet",
            "card reader",
            "cardboard boxes",
            "kitchen light",
            "paper notes",
            "pc charger",
            "product dispenser bottle",
            "hair dryer holder",
            "screwdriver",
            "shower squeegee",
            "juice tetrapack",
            "pliers",
            "sunblock",
            "bed sheet",
            "whiteboard pens",
            "fruits",
            "hook",
            "headphone holder",
            "light bulb",
            "weight plates",
            "ladle",
            "bar soap",
            "button",
            "dish brush",
            "toy car",
            "note",
            "post it",
            "sponge cloth",
            "wood stick",
            "light switchs",
            "paper weight",
            "product tube",
            "cell phone",
            "smartphone",
            "comb",
            "jump rope",
            "lan",
            "wireless charger",
            "door stopper",
            "cigarette packet",
            "pencil",
            "soap holder",
            "electrical plug",
            "toilet holder",
            "mask",
            "pocket calculator",
            "cabbage",
            "spoon",
            "doorknob",
            "fan switch",
            "rubber duck",
            "backdrop hook",
            "table tennis racket",
            "oven controls",
            "receipt",
            "soap bar",
            "tape roll",
            "tooth paste",
            "electrical adapter",
            "probe",
            "highlighter",
            "correction fluid",
            "dispenser",
            "pi̇cture",
            "door hinge",
            "whiteboard marker holder",
            "botttle",
            "decoration pieces",
            "power outlet",
            "towel hanger",
            "whiteboard duster",
            "magnet",
            "sticker",
            "nose spray",
            "flushes",
            "vertical blind control",
            "razor blade",
            "post it note",
            "wireless headphones",
            "cabinet top",
            "cream bottle",
            "datashow socket",
            "earbuds",
            "cabinet door",
            "chair cushion",
            "cosmetic tube",
        ]

def read_aggregation(filename):
    assert os.path.isfile(filename)
    object_id_to_segs = {}
    label_to_segs = {}
    with open(filename) as f:
        data = json.load(f)
        num_objects = len(data["segGroups"])
        for i in range(num_objects):
            object_id = data["segGroups"][i][
                "objectId"] + 1  # instance ids should be 1-indexed
            label = data["segGroups"][i]["label"]
            segs = data["segGroups"][i]["segments"]
            object_id_to_segs[object_id] = segs
            if label in label_to_segs:
                label_to_segs[label].extend(segs)
            else:
                label_to_segs[label] = segs
    return object_id_to_segs, label_to_segs


def read_segmentation(filename):
    assert os.path.isfile(filename)
    seg_to_verts = {}
    with open(filename) as f:
        data = json.load(f)
        num_verts = len(data["segIndices"])
        for i in range(num_verts):
            seg_id = data["segIndices"][i]
            if seg_id in seg_to_verts:
                seg_to_verts[seg_id].append(i)
            else:
                seg_to_verts[seg_id] = [i]
    return seg_to_verts, num_verts


def extract_bbox(mesh_vertices, object_id_to_segs, object_id_to_label_id,
                 instance_ids):
    num_instances = len(np.unique(list(object_id_to_segs.keys()))) + 1
    instance_bboxes = np.zeros((num_instances, 7))
    # print(object_id_to_segs)
    for obj_id in object_id_to_segs:
        label_id = object_id_to_label_id[obj_id]
        obj_pc = mesh_vertices[instance_ids == obj_id, 0:3]
        if len(obj_pc) == 0:
            continue
        xyz_min = np.min(obj_pc, axis=0)
        xyz_max = np.max(obj_pc, axis=0)
        bbox = np.concatenate([(xyz_min + xyz_max) / 2.0, xyz_max - xyz_min,
                               np.array([label_id])])
        # NOTE: this assumes obj_id is in 1,2,3,.,,,.NUM_INSTANCES
        instance_bboxes[obj_id - 1, :] = bbox
    return instance_bboxes


def export(mesh_file,
           agg_file,
           seg_file,
           meta_file,
           label_map_file,
           output_file=None,
           test_mode=False):
    """Export original files to vert, ins_label, sem_label and bbox file.

    Args:
        mesh_file (str): Path of the mesh_file.
        agg_file (str): Path of the agg_file.
        seg_file (str): Path of the seg_file.
        meta_file (str): Path of the meta_file.
        label_map_file (str): Path of the label_map_file.
        output_file (str): Path of the output folder.
            Default: None.
        test_mode (bool): Whether is generating test data without labels.
            Default: False.

    It returns a tuple, which contains the the following things:
        np.ndarray: Vertices of points data.
        np.ndarray: Indexes of label.
        np.ndarray: Indexes of instance.
        np.ndarray: Instance bboxes.
        dict: Map from object_id to label_id.
    """
    print("loading mesh vertices")
    mesh_vertices = scannet_utils.read_mesh_vertices_rgb(mesh_file)
    # mesh_vertices = o3d.io.read_triangle_mesh(mesh_file).
    mesh_vertices = np.asarray(mesh_vertices)
    print(mesh_vertices.shape)

    # Load scene axis alignment matrix
    print("loading axis alignment matrix")
    # test set data doesn't have align_matrix
    axis_align_matrix = np.eye(4)
    if meta_file is not None:
        lines = open(meta_file).readlines()
        for line in lines:
            if "axisAlignment" in line:
                axis_align_matrix = [
                    float(x)
                    for x in line.rstrip().strip("axisAlignment = ").split(" ")
                ]
                break
        axis_align_matrix = np.array(axis_align_matrix).reshape((4, 4))

    # perform global alignment of mesh vertices
    print("aligning mesh vertices")
    pts = np.ones((mesh_vertices.shape[0], 4))
    pts[:, 0:3] = mesh_vertices[:, 0:3]
    pts = np.dot(pts, axis_align_matrix.transpose())  # Nx4
    aligned_mesh_vertices = np.concatenate([pts[:, 0:3], mesh_vertices[:, 3:]],
                                           axis=1)

    # Load semantic and instance labels
    print("loading semantic and instance labels")
    if not test_mode:
        print("read annotation files")
        object_id_to_segs, label_to_segs = read_aggregation(agg_file)
        seg_to_verts, num_verts = read_segmentation(seg_file)
        label_ids = np.zeros(shape=(num_verts), dtype=np.uint32)
        object_id_to_label_id = {}

        print("load label mapping")
        for label, segs in label_to_segs.items():
            # label_id = label_map[label]
            if label in SCANNETPP_LABELS:
                label_id = SCANNETPP_LABELS.index(label)
            elif label.lower() == "split":
                label_id = len(SCANNETPP_LABELS) + 1
            elif label.lower() == "remove":
                label_id = len(SCANNETPP_LABELS) + 2
            else:
                print("Unknown label:", label)
                label_id = len(SCANNETPP_LABELS) + 3
            for seg in segs:
                verts = seg_to_verts[seg]
                label_ids[verts] = label_id

        print("assign label id to object id")
        instance_ids = np.zeros(
            shape=(num_verts), dtype=np.uint32)  # 0: unannotated
        for object_id, segs in object_id_to_segs.items():
            for seg in segs:
                verts = seg_to_verts[seg]
                instance_ids[verts] = object_id
                if object_id not in object_id_to_label_id:
                    object_id_to_label_id[object_id] = label_ids[verts][0]

        print("extracting bboxes")
        unaligned_bboxes = extract_bbox(mesh_vertices, object_id_to_segs,
                                        object_id_to_label_id, instance_ids)
        aligned_bboxes = extract_bbox(aligned_mesh_vertices, object_id_to_segs,
                                      object_id_to_label_id, instance_ids)
    else:
        label_ids = None
        instance_ids = None
        unaligned_bboxes = None
        aligned_bboxes = None
        object_id_to_label_id = None

    print("saving output")
    if output_file is not None:
        np.save(output_file + "_vert.npy", mesh_vertices)
        if not test_mode:
            np.save(output_file + "_sem_label.npy", label_ids)
            np.save(output_file + "_ins_label.npy", instance_ids)
            np.save(output_file + "_unaligned_bbox.npy", unaligned_bboxes)
            np.save(output_file + "_aligned_bbox.npy", aligned_bboxes)
            np.save(output_file + "_axis_align_matrix.npy", axis_align_matrix)

    return mesh_vertices, label_ids, instance_ids, unaligned_bboxes, \
        aligned_bboxes, object_id_to_label_id, axis_align_matrix


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "--scan_path",
        required=True,
        help="path to scannet scene (e.g., data/ScanNet/v2/scene0000_00")
    parser.add_argument("--output_file", required=True, help="output file")
    parser.add_argument(
        "--label_map_file",
        required=True,
        help="path to scannetv2-labels.combined.tsv")
    parser.add_argument(
        "--scannet200",
        action="store_true",
        help="Use it for scannet200 mapping")

    opt = parser.parse_args()

    scan_name = os.path.split(opt.scan_path)[-1]
    mesh_file = os.path.join(opt.scan_path, scan_name, "scans", "mesh_aligned_0.05_semantic.ply")
    # agg_file = os.path.join(opt.scan_path, scan_name + '.aggregation.json')
    seg_file = os.path.join(opt.scan_path,
                            scan_name, "scans", "segments_anno.json")
    meta_file = os.path.join(
        opt.scan_path, scan_name +
        ".txt")  # includes axisAlignment info for the train set scans.
    export(mesh_file, seg_file, seg_file, meta_file, opt.label_map_file,
           opt.output_file, scannet200=opt.scannet200)


if __name__ == "__main__":
    main()
